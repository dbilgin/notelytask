# This file was auto-generated by the Firebase CLI
# https://github.com/firebase/firebase-tools

name: Deploy to Firebase

on:
  create:
    tags:
      - v*

jobs:
  build_and_preview:
    runs-on: ubuntu-latest
    steps:
        # Setup Java environment in order to build the Android app.
      - uses: actions/checkout@v2

      - run: echo "${{ secrets.ENV_FILE }}" | base64 --decode > .env

      # Setup the flutter environment.
      - uses: subosito/flutter-action@v1
        with:
          channel: 'stable' # 'dev', 'alpha', default to: 'stable'

      - run: flutter doctor -v

      - run: flutter clean

      # Get flutter dependencies.
      - run: flutter pub get

      # Check for any formatting issues in the code.
      - run: flutter format --set-exit-if-changed .

      # Statically analyze the Dart code for any errors.
      - run: flutter analyze .

      - name: Build Release
        run: flutter build web

      - name: Deploy to Firebase
        uses: w9jds/firebase-action@master
        with:
          args: deploy --only hosting
        env:
          FIREBASE_TOKEN: ${{ secrets.FIREBASE_TOKEN }}